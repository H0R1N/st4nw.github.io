---
layout: post
title: "pwnable.kr - unexploitable / exploitable"
date: 2018-11-14
excerpt: "return to csu + sys_execve / one_gadget + libc trick"
tags: [write-up]
comments: true
---
방법론만 제시하고 exploit 코드는 올리지 않겠습니다.

### Unexploitable

#### Analysis

- read만 주어져있습니다.

- rdi / rsi / rdx를 세팅할 가젯은 없습니다.

#### Exploit

- intended solution은 SROP 이지만, 저는 return to csu로 해결했습니다. 추후 SROP로 다시 한번 풀어볼 예정입니다.

- return to csu를 이용해 read의 인자 세팅이 가능합니다.

- sleep의 libc 주소 하위 한 바이트를 \x8e로 덮어 syscall로 이용할 수 있습니다.

- bss에 /bin/sh를 써주면서 payload의 길이를 59로 조절해 rax를 세팅할 수 있고, 이로 execve syscall를 call하는게 가능합니다.

### Exploitable

#### Analysis

- stdout을 바이너리 자체에서 leak해주어 libc leak을 얻을 수 있습니다.

- 그 후 signed int인 v4에 입력받아 v4(0xdeadbeef);를 실행합니다.

#### Exploit

- oneshot gadget을 구해 입력해도 signed int이기 때문에 0x7f??????인 oneshot gadget의 주소는 integer overflow를 발생시킵니다.

- 적당히 트릭을 이용해 주소를 가공해 입력하면 oneshot gadget을 정상적으로 실행할 수 있습니다.
